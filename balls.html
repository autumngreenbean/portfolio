<!DOCTYPE html>
<html>
<head>
    <title>Ball Drop</title>
    <style>
        canvas {
            border: 1px solid black;
        }
    </style>
</head>
<body>
    <canvas id="canvas" width="800" height="600"></canvas>

    <script>
        // Constants
        const canvas = document.getElementById('canvas');
        const ctx = canvas.getContext('2d');
        const WIDTH = canvas.width;
        const HEIGHT = canvas.height;
        const BALL_RADIUS = 20;
        const BALL_COLOR_1 = 'red';
        const BALL_COLOR_2 = 'blue';
        const GRAVITY = 0.1;
        const FPS = 60;

        // Audio context
        const audioContext = new (window.AudioContext || window.webkitAudioContext)();

        // Ball properties
        let balls = [
            { x: WIDTH / 4, y: 0, speed: 0, audioBuffer: null, audioSource: null },
            { x: (3 * WIDTH) / 4, y: 0, speed: 10, audioBuffer: null, audioSource: null }
        ];

        // Load audio files and start the animation when ready
        Promise.all([
            loadAudioFile('bounce.mp3', 0),
            loadAudioFile('bounce2.mp3', 1)
        ]).then(() => {
            // Start the animation
            update();
        }).catch(error => {
            console.error("Error loading audio:", error);
        });

        // Load audio file and create audio buffer
        function loadAudioFile(url, ballIndex) {
            return new Promise((resolve, reject) => {
                const request = new XMLHttpRequest();
                request.open('GET', url, true);
                request.responseType = 'arraybuffer';

                request.onload = function () {
                    audioContext.decodeAudioData(request.response, function (buffer) {
                        balls[ballIndex].audioBuffer = buffer;
                        resolve();
                    }, function (error) {
                        reject(error);
                    });
                };

                request.send();
            });
        }

        // Main loop
        function update() {
            // Simulate gravity for each ball
            balls.forEach(ball => {
                ball.speed += GRAVITY;
                ball.y += ball.speed;

                // Check for collision with the ground
                if (ball.y + BALL_RADIUS > HEIGHT) {
                    ball.y = HEIGHT - BALL_RADIUS;
                    ball.speed *= -0.8;  // Bounce with some loss
                    playBounceSound(ball);
                }
            });

            // Clear the canvas
            ctx.clearRect(0, 0, WIDTH, HEIGHT);

            // Draw each ball
            balls.forEach(ball => {
                ctx.beginPath();
                ctx.arc(ball.x, ball.y, BALL_RADIUS, 0, Math.PI * 2);
                ctx.fillStyle = (ball === balls[0]) ? BALL_COLOR_1 : BALL_COLOR_2;
                ctx.fill();
                ctx.closePath();
            });

            requestAnimationFrame(update);
        }

        // Function to play the bounce sound
        function playBounceSound(ball) {
            if (ball.audioSource) {
                ball.audioSource.disconnect();
            }

            ball.audioSource = audioContext.createBufferSource();
            ball.audioSource.buffer = ball.audioBuffer;
            ball.audioSource.connect(audioContext.destination);
            ball.audioSource.start();
        }
    </script>
</body>
</html>
